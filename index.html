<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MandEval Vaccine Mandate Policy Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="app-header__title-block">
        <h1>MandEval Vaccine Mandate Policy Tool</h1>
        <p class="app-header__subtitle">
          Explore how alternative vaccine mandate designs affect predicted public support
          in Australia, Italy and France under mild and severe COVID-19 outbreak scenarios.
        </p>
      </div>
      <div class="app-header__selectors">
        <div class="control">
          <label for="countrySelect">Country</label>
          <select id="countrySelect"></select>
        </div>
        <div class="control">
          <label for="scenarioSelect">Outbreak scenario</label>
          <select id="scenarioSelect"></select>
        </div>
      </div>
    </header>

    <main class="app-main">
      <div id="errorMessage" class="error-message" aria-live="polite"></div>

      <section class="controls controls--tabs">
        <nav class="tabs" aria-label="Tool sections">
          <button class="tab-button tab-button--active" data-tab-target="tab-overview">
            Overview
          </button>
          <button class="tab-button" data-tab-target="tab-policy">
            Policy builder
          </button>
          <button class="tab-button" data-tab-target="tab-results">
            Impact &amp; support
          </button>
          <button class="tab-button" data-tab-target="tab-equivalence">
            Trade-offs
          </button>
          <button class="tab-button" data-tab-target="tab-appendix">
            Technical appendix
          </button>
          <button class="tab-button" data-tab-target="tab-methods">
            Methods &amp; data
          </button>
        </nav>
      </section>

      <!-- OVERVIEW TAB -->
      <section id="tab-overview" class="tab-panel tab-panel--active" aria-label="Overview">
        <div class="card-grid">
          <section class="card card--wide">
            <h2>What this tool does</h2>
            <p>
              This tool uses discrete choice experiment (DCE) estimates from the MandEval study to
              predict how different vaccine mandate designs affect the probability that people
              <strong>support having some mandate</strong> versus <strong>prefer no mandate</strong>.
            </p>
            <p>
              Select a country and outbreak scenario at the top. Then use the
              <strong>Policy builder</strong> tab to choose:
            </p>
            <ul>
              <li>Who would be covered by the mandate</li>
              <li>Which exemptions are allowed</li>
              <li>Vaccination coverage required before mandates end</li>
              <li>Expected additional lives saved per 100&nbsp;000 people</li>
            </ul>
            <p>
              The <strong>Impact &amp; support</strong> tab then shows predicted support for
              mandates. The <strong>Trade-offs</strong> tab reports how many additional lives saved per
              100&nbsp;000 people are, in the model, equivalent to changes in mandate scope or
              exemptions.
            </p>
          </section>

          <section class="card">
            <h2>Sample &amp; design (current view)</h2>
            <dl class="kpi-grid">
              <div>
                <dt>Respondents</dt>
                <dd id="sampleSizeOverview">—</dd>
              </div>
              <div>
                <dt>Choice tasks per person</dt>
                <dd id="tasksPerPersonOverview">—</dd>
              </div>
              <div>
                <dt>Total analysed choices</dt>
                <dd id="totalChoicesOverview">—</dd>
              </div>
            </dl>
            <h3>Model diagnostics</h3>
            <dl class="kpi-grid">
              <div>
                <dt>Model</dt>
                <dd id="modelNameOverview">Mixed logit (preference space)</dd>
              </div>
              <div>
                <dt>Log-likelihood</dt>
                <dd id="logLikOverview">—</dd>
              </div>
              <div>
                <dt>AIC</dt>
                <dd id="aicOverview">—</dd>
              </div>
            </dl>
          </section>

          <section class="card">
            <h2>Preference segments</h2>
            <p>
              Latent class analysis identifies at least two preference segments in each country:
              a majority <strong>mandate-supporter</strong> group and a smaller
              <strong>mandate-resister</strong> group.
            </p>
            <ul id="segmentOverviewList" class="segment-list"></ul>
          </section>
        </div>
      </section>

      <!-- POLICY BUILDER TAB -->
      <section id="tab-policy" class="tab-panel" aria-label="Policy builder">
        <div class="card card--wide">
          <h2>Configure a vaccine mandate policy</h2>
          <p>
            Choose the combination of mandate features you would like to evaluate. The
            predictions are based on support for having <strong>some mandate in place</strong>
            versus <strong>no mandate</strong>; there is no separate “uptake for A” or “uptake for B”.
          </p>
          <div class="policy-grid">
            <div class="policy-group">
              <label for="scopeSelect">Who would be covered by the mandate?</label>
              <select id="scopeSelect"></select>
              <p class="hint">
                Broader mandates (e.g. all adults) generally reduce support relative to
                narrower mandates that focus on high-risk groups.
              </p>
            </div>

            <div class="policy-group">
              <label for="exemptionsSelect">What exemptions are allowed?</label>
              <select id="exemptionsSelect"></select>
              <p class="hint">
                Allowing only medical exemptions is typically seen as stricter than allowing
                both medical and religious exemptions.
              </p>
            </div>

            <div class="policy-group">
              <label for="coverageSelect">
                Vaccination coverage required before the mandate ends
              </label>
              <select id="coverageSelect"></select>
              <p class="hint">
                Higher coverage thresholds signal a longer mandate and can require stronger
                justification in terms of lives saved.
              </p>
            </div>

            <div class="policy-group">
              <label for="livesSaved">
                Additional lives saved compared with no mandate
              </label>
              <input
                type="range"
                id="livesSaved"
                min="10"
                max="40"
                step="5"
              />
              <div class="slider-value">
                <span id="livesSavedValue">—</span>
              </div>
              <p class="hint">
                This represents extra lives saved per 100&nbsp;000 people due to the mandate
                (e.g. through higher vaccination coverage).
              </p>
            </div>
          </div>

          <div class="policy-actions">
            <button id="resetPolicyButton" type="button" class="btn-secondary">
              Reset to scenario defaults
            </button>
          </div>
        </div>
      </section>

      <!-- RESULTS TAB -->
      <section id="tab-results" class="tab-panel" aria-label="Impact & support">
        <div class="card-grid">
          <section class="card card--wide">
            <h2>Predicted support for this mandate</h2>
            <p>
              For the selected country, outbreak scenario and policy configuration, the mixed logit
              model predicts the share of respondents who would
              <strong>support having some mandate</strong> versus those who would
              <strong>prefer no mandate</strong>.
            </p>
            <div class="chart-container">
              <canvas id="supportChart" aria-label="Predicted support vs no mandate" role="img"></canvas>
            </div>
            <p id="supportSummaryText" class="muted">
              Choose a country, scenario and policy design to view predicted support.
            </p>
          </section>

          <section class="card">
            <h3>Key indicators</h3>
            <dl class="kpi-grid">
              <div>
                <dt>Support mandate</dt>
                <dd id="supportRate">—</dd>
              </div>
              <div>
                <dt>Prefer no mandate</dt>
                <dd id="noMandateRate">—</dd>
              </div>
              <div>
                <dt>Odds ratio (support vs no mandate)</dt>
                <dd id="supportOdds">—</dd>
              </div>
              <div>
                <dt>Sample size</dt>
                <dd id="sampleSize">—</dd>
              </div>
            </dl>
          </section>

          <section class="card">
            <h3>Preference segments for this scenario</h3>
            <p>
              The latent class model identifies mandate supporters and mandate resisters in each
              country. Shares are based on the MandEval DCE and can be updated as new estimates
              become available.
            </p>
            <ul id="segmentResultsList" class="segment-list"></ul>
          </section>
        </div>
      </section>

      <!-- TRADE-OFFS TAB -->
      <section id="tab-equivalence" class="tab-panel" aria-label="Trade-offs">
        <div class="card card--wide">
          <h2>Trade-offs in terms of lives saved</h2>
          <p>
            Using the mixed logit estimates, the table below expresses each mandate attribute
            level as an equivalent number of <strong>additional lives saved per 100&nbsp;000 people</strong>.
            These values are based on ratios of attribute coefficients to the
            <em>lives saved</em> coefficient.
          </p>
          <p class="muted">
            For example, if “all adults” has an equivalent of 30 lives per 100&nbsp;000, the model
            implies that moving from “high-risk groups only” to “all adults” would need to be offset
            by saving roughly 30 extra lives per 100&nbsp;000 to keep support at the same level.
          </p>
          <div class="table-wrapper">
            <table class="table">
              <thead>
                <tr>
                  <th>Attribute</th>
                  <th>Level (vs reference)</th>
                  <th>Equivalent lives saved per 100&nbsp;000<br />(95% CI)</th>
                </tr>
              </thead>
              <tbody id="equivalenceTableBody">
                <tr>
                  <td colspan="3">Select a country and scenario to view results.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- TECHNICAL APPENDIX TAB -->
      <section id="tab-appendix" class="tab-panel" aria-label="Technical appendix">
        <div class="card card--wide">
          <h2>Technical appendix: model structure and worked example</h2>

          <h3>Discrete choice model</h3>
          <p>
            The MandEval DCE presents respondents with repeated hypothetical choice tasks between
            two vaccine mandate options and an explicit <strong>“no mandate”</strong> alternative.
            Let <code>M</code> denote a mandate with attributes
            <code>x</code> and <code>N</code> denote the no-mandate option. For the purpose
            of this policy tool, the focus is on the binary choice between
            <strong>some mandate</strong> and <strong>no mandate</strong>.
          </p>

          <p>
            For each country–scenario combination, the mixed logit model in preference space
            can be written as:
          </p>
          <pre class="math">
V<sub>Mandate</sub> = β<sub>0</sub> + β<sub>scope</sub> · Scope + β<sub>ex</sub> · Exemptions
                     + β<sub>cov</sub> · Coverage + β<sub>life</sub> · (LivesSaved / 10)

V<sub>NoMandate</sub> = α<sub>No</sub>
          </pre>
          <p>
            where <code>LivesSaved</code> is expressed as additional lives saved per 100&nbsp;000
            relative to a base value (here 10 per 100&nbsp;000). The tool uses the estimated
            coefficient on <code>LivesSaved</code> (per 10-life increment) and the
            categorical coefficients for scope, exemptions and coverage.
          </p>

          <p>
            The probability of supporting a mandate (aggregating over the two labelled mandate
            options in the original design) is computed as a two-alternative logit:
          </p>
          <pre class="math">
P(Support mandate) = exp(V<sub>Mandate</sub>) / [exp(V<sub>Mandate</sub>) + exp(V<sub>NoMandate</sub>)]
P(Prefer no mandate) = 1 − P(Support mandate)
          </pre>

          <h3>Coefficient mapping</h3>
          <p>
            In the configuration file (<code>mandeval_config.json</code>), each attribute level is linked
            to its corresponding model coefficient via a <code>coef_key</code>. For example
            (Australia, mild outbreak):
          </p>
          <pre class="code-snippet">
"coverage": {
  "label": "Coverage required before mandate ends",
  "reference": "70",
  "levels": {
    "70": { "label": "70% of the population", "coef_key": null },
    "80": { "label": "80% of the population", "coef_key": "coverage_80" },
    "90": { "label": "90% of the population", "coef_key": "coverage_90" }
  }
},
"lives_saved": {
  "label": "Additional lives saved compared with no mandate",
  "unit": "lives per 100,000 people",
  "reference": 10,
  "min": 10,
  "max": 40,
  "step": 5,
  "coef_key": "lives_saved_10"
}
          </pre>
          <p>
            The JSON section <code>mxl.coefficients</code> then stores the mean and standard error
            of each coefficient (to be populated with your exact estimates from the MandEval models):
          </p>
          <pre class="code-snippet">
"coefficients": {
  "asc_optout":              { "mean": -2.187, "se": 0.160 },
  "coverage_80":             { "mean":  0.214, "se": 0.055 },
  "coverage_90":             { "mean":  0.378, "se": 0.070 },
  "lives_saved_10":          { "mean":  0.023, "se": 0.004 },
  "scope_all_occupations_public": { "mean": -0.585, "se": 0.090 },
  "scope_all_adults":        { "mean": -1.020, "se": 0.110 },
  "exemptions_medical_religious": { "mean":  0.125, "se": 0.060 }
}
          </pre>
          <p>
            For prediction, the tool uses:
          </p>
          <pre class="math">
V<sub>Mandate</sub> =
  β<sub>scope(level)</sub> + β<sub>ex(level)</sub> + β<sub>cov(level)</sub> +
  β<sub>life</sub> · (LivesSaved − 10)/10

V<sub>NoMandate</sub> = α<sub>No</sub> = asc_optout
          </pre>

          <h3>Worked example (Australia, mild outbreak)</h3>
          <p>
            Suppose we consider a mandate in Australia under a mild outbreak with:
          </p>
          <ul>
            <li>Scope: high-risk groups only (reference)</li>
            <li>Exemptions: medical reasons only (reference)</li>
            <li>Coverage threshold: 80% (vs 70% reference)</li>
            <li>Additional lives saved: 25 per 100&nbsp;000 (vs 10 in the reference)</li>
          </ul>
          <p>
            Using the illustrative coefficients above:
          </p>
          <pre class="math">
β<sub>cov(80)</sub> = 0.214
β<sub>life</sub>    = 0.023  (per 10 lives per 100,000)
α<sub>No</sub>      = -2.187
LivesSaved          = 25 (per 100,000)
Reference           = 10 (per 100,000)
          </pre>

          <p>
            The mandate utility becomes:
          </p>
          <pre class="math">
V<sub>Mandate</sub> =
  0.214                                   (80% vs 70% coverage) +
  0.023 · (25 − 10) / 10                  (extra lives saved)
= 0.214 + 0.023 · 1.5
= 0.214 + 0.0345
≈ 0.249
          </pre>

          <p>
            The no-mandate utility is:
          </p>
          <pre class="math">
V<sub>NoMandate</sub> = -2.187
          </pre>

          <p>
            The resulting probabilities are:
          </p>
          <pre class="math">
P(Support mandate)   = exp(0.249) / [exp(0.249) + exp(-2.187)]
                     ≈ 0.92

P(Prefer no mandate) = 1 − 0.92
                     ≈ 0.08
          </pre>

          <p>
            The tool implements this calculation generically for any combination of scope,
            exemptions, coverage and lives-saved levels, using the country- and
            scenario-specific coefficients from <code>mandeval_config.json</code>.
            To use the exact MandEval results, replace the illustrative coefficient values in
            the JSON file with the estimates from your final mixed logit and latent class models.
          </p>

          <h3>Trade-offs in lives saved</h3>
          <p>
            For each non-reference level of scope, exemptions and coverage, the tool reports the
            number of extra lives saved per 100&nbsp;000 that would compensate for that level,
            holding overall support constant. For an attribute level with coefficient
            <code>β<sub>j</sub></code> and a lives-saved coefficient
            <code>β<sub>life</sub></code> (per 10 lives), the equivalent lives saved is:
          </p>
          <pre class="math">
LivesEquivalent<sub>j</sub> =
  (β<sub>j</sub> / β<sub>life</sub>) · 10   (lives per 100,000)
          </pre>
          <p>
            Approximate 95% confidence intervals are computed using the delta method, assuming
            independence between coefficients:
          </p>
          <pre class="math">
Var(β<sub>j</sub> / β<sub>life</sub>) ≈ (σ<sub>j</sub> / β<sub>j</sub>)²
                                      + (σ<sub>life</sub> / β<sub>life</sub>)²

SE(ratio) = |β<sub>j</sub> / β<sub>life</sub>| · √Var(·)

CI<sub>ratio</sub> = (β<sub>j</sub> / β<sub>life</sub>) ± 1.96 · SE(ratio)

CI<sub>Lives</sub> = CI<sub>ratio</sub> · 10
          </pre>
        </div>
      </section>

      <!-- METHODS TAB -->
      <section id="tab-methods" class="tab-panel" aria-label="Methods & data">
        <div class="card card--wide">
          <h2>Methods &amp; data</h2>
          <p>
            The tool is calibrated to the MandEval discrete choice experiment on public preferences
            for COVID-19 vaccine mandates conducted in Australia, Italy and France. Respondents
            completed repeated choice tasks in which they selected between two mandate options and
            an explicit “no mandate” alternative under mild and severe outbreak scenarios.
          </p>
          <p>
            Model estimates are based on mixed logit specifications in preference space with
            respondent-clustered standard errors. The coefficient on additional lives saved is
            treated as a continuous attribute; scope, exemptions and coverage thresholds are
            modelled as categorical attributes with clearly defined reference levels.
          </p>
          <p>
            In addition, a latent class logit model identifies at least two preference segments:
            a majority mandate-supporter class and a smaller mandate-resister class. Segment
            shares for each country and scenario are stored in <code>lc_segments</code> within
            <code>mandeval_config.json</code> and are displayed in the
            <strong>Overview</strong> and <strong>Impact &amp; support</strong> tabs.
          </p>
          <p>
            The current implementation uses the <strong>mean coefficients</strong> from the mixed
            logit models to generate point predictions for mandate support. To ensure numerical
            accuracy for your application, paste the final MandEval estimates (means, standard
            errors and class shares) into <code>mandeval_config.json</code> for each
            country–scenario combination.
          </p>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <p>MandEval Vaccine Mandate Policy Tool &middot; Version 1.1</p>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
